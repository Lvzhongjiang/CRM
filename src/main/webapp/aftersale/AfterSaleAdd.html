<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>新增售后服务</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="/static/layui/css/layui.css"  media="all">
    <!-- 注意：如果你直接复制所有代码到本地，上述css路径需要改成你本地的 -->
</head>
<body>
<!-- 示例-970
<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
    <legend>新增售后服务</legend>
</fieldset>-->
<div>
<label style="color: blue">基本信息：</label>
<ins class="adsbygoogle" style="display:inline-block;width:970px;height:90px" data-ad-client="ca-pub-6111334333458862" data-ad-slot="3820120620"></ins>
<form class="layui-form"  lay-filter="example">
    <div class="layui-form-item">
        <label class="layui-form-label"><font color="red">*</font> 售后主题</label>
        <div class="layui-input-block">
            <input type="text" name="theme" lay-verify="required" autocomplete="off" placeholder="请输入售后主题" class="layui-input" style="width:720px">
        </div>
    </div><br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;步骤:     服务登记      责任人: 王娜,      参与人:<br><br>
    <label style="color: blue">售后服务信息：</label>
    <div class="layui-form-item">
        <label class="layui-form-label"><font color="red">*</font> 客户名称:</label>
        <div class="layui-input-inline"  style="width: 300px">
            <select name="clientid" id="client" lay-verify="required" lay-filter="client">
                <option value=""></option>
            </select>
        </div>
        <label class="layui-form-label"> 合同编号:</label>
        <div class="layui-input-inline"  style="width: 300px">
            <select name="contractid" id="cont"  lay-verify="required" lay-filter="cont">
                <option value=""></option>
            </select>
        </div>
    </div>
    <div id="message" style="display: none">
    <div class="layui-form-item">
        <label class="layui-form-label">合同信息:</label>
        <div class="layui-input-block" style="width: 720px">
            <textarea name="maincontent" id="contMessage" class="layui-textarea" readonly="readonly"></textarea>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label" style="width: 100px"><font color="red">*</font> 对方联系人：</label>
        <div class="layui-input-inline">
            <input type="text" name="Contactperson" lay-verify="required" autocomplete="off" placeholder="请输入联系人" class="layui-input" style="width:250px">
        </div>
        <label class="layui-form-label" style="width: 200px"> 固定电话：</label>
        <div class="layui-input-inline">
            <input type="text" name="fixedtelephones" placeholder="请输入固定电话" lay-verify="required" autocomplete="off"  class="layui-input" style="width:270px">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label" style="width: 100px">移动电话：</label>
        <div class="layui-input-inline">
            <input type="text" name="mobiletelephones" placeholder="请输入移动电话" lay-verify="required|phone|number" autocomplete="off" class="layui-input" style="width:250px">
        </div>
        <label class="layui-form-label" style="width: 200px"> 邮件/QQ：</label>
        <div class="layui-input-inline">
            <input type="text" name="post" placeholder="请输入邮箱" lay-verify="email" autocomplete="off"  class="layui-input" style="width:270px">
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">服务类型:</label>
        <div class="layui-input-inline"  style="width: 300px">
            <select name="typeservice" id="typeservice" lay-filter="aihao">
            </select>
        </div>
        <label class="layui-form-label"> 服务方式:</label>
        <div class="layui-input-inline"  style="width: 300px">
            <select name="modelservice"  id="modelservice"lay-filter="aihao">
            </select>
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">开始时间:</label>
        <div class="layui-input-inline"  style="width: 300px">
            <input type="text" name="starttime" id="date" lay-verify="date" placeholder="yyyy-MM-dd" autocomplete="off" class="layui-input">
        </div>
        <label class="layui-form-label"> 结束时间:</label>
        <div class="layui-input-inline"  style="width: 300px">
            <input type="text" name="endtime" id="date1" lay-verify="date" placeholder="yyyy-MM-dd" autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label"><font color="red">*</font> 服务内容:</label>
        <div class="layui-input-block" style="width: 720px">
            <textarea name="content" placeholder="请输入内容" class="layui-textarea"></textarea>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">客户反馈：</label>
        <div class="layui-input-block" style="width: 720px">
            <textarea name="feedback" placeholder="请输入内容" class="layui-textarea"></textarea>
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label"><font color="red">*</font> 服务人员:</label>
        <div class="layui-input-inline"  style="width: 300px">
            <input type="text" name="personnel" lay-verify="required" autocomplete="off"  class="layui-input" style="width:270px">
        </div>
        <label class="layui-form-label"> 服务评分:</label>
        <div class="layui-input-inline"  style="width: 300px">
            1<input type="radio" checked name="Servicescore" value="1">
            2<input type="radio" name="Servicescore" value="2">
            3<input type="radio" name="Servicescore" value="3">
            4<input type="radio" name="Servicescore" value="4">
            5<input type="radio" name="Servicescore" value="5">
        </div>
    </div>
    <div class="layui-input-inline">
        <div class="layui-input-inline">
            <button type="button" class="layui-btn" id="test1">
                <i class="layui-icon">&#xe67c;</i>上传附件
            </button>
            <button type="submit" class="layui-btn" lay-submit="" lay-filter="demo1">立即提交</button>
        </div>
    </div>
    </div>
</form>
<script src="/static/layui/layui.js" charset="utf-8"></script>
<script src="/static/jquery-3.3.1.js" charset="utf-8"></script>
<!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
<script>
    layui.use(['form', 'layedit','table',  'laydate','rate','upload'], function(){
        var form = layui.form
            ,layer = layui.layer
            ,layedit = layui.layedit
            ,laydate = layui.laydate;
        var rate = layui.rate;
        var $ = layui.jquery
            ,upload = layui.upload;
//日期
        laydate.render({
            elem: '#date'
        });
        laydate.render({
            elem: '#date1'
        });

        //创建一个编辑器
        var editIndex = layedit.build('LAY_demo_editor');

        //监听指定开关
        form.on('switch(switchTest)', function(data){
            layer.msg('开关checked：'+ (this.checked ? 'true' : 'false'), {
                offset: '6px'
            });
            layer.tips('温馨提示：请注意开关状态的文字可以随意定义，而不仅仅是ON|OFF', data.othis)
        });


        /*
        * 客户下拉框值改变事件
        * */
        form.on('select(client)',function(data){
            $("#message").hide();
            $.ajax({
                type:"GET",
                url:"/queryCont.do",
                data:{
                    cid:data.value
                },
                dataType:"json",
                success:function(is){
                    $("#cont").find("option").remove();
                    var dep=document.getElementById("cont");
                    var op=new Option('请选择合同','-1');
                    dep.add(op);
                    for(var i=0;i<is.length;i++){
                        var op=new Option(is[i].contName,is[i].contId);
                        dep.add(op);
                    }
                    form.render("select");
                },
                error:function(jqXHR){
                    console.log("Error: "+jqXHR.status);
                }
            });
        });
        //监听提交
        form.on('submit(demo1)', function(data){
            $.ajax({
                type:"get",
                url:"/afterSaleSave.do",
                data:{
                    theme:data.field.theme
                    ,clientid:data.field.clientid
                    ,contractid:data.field.contractid
                    ,maincontent:data.field.maincontent
                    ,Contactperson:data.field.Contactperson
                    ,fixedtelephones:data.field.fixedtelephones
                    ,mobiletelephones:data.field.mobiletelephones
                    ,post:data.field.post
                    ,typeservice:data.field.typeservice
                    ,modelservice:data.field.modelservice
                    ,starttime:data.field.starttime
                    ,endtime:data.field.endtime
                    ,content:data.field.content
                    ,feedback:data.field.feedback
                    ,personnel:data.field.personnel
                    ,Servicescore:data.field.Servicescore
                },
                dataType:"json",
                success:function(is){
                    if(is=='1'){
                        layer.msg('添加成功', {icon: 6});
                        var index=parent.layer.getFrameIndex(window.name);
                        parent.layer.close(index);

                    }else{
                        layer.msg('添加失败');
                    }
                },
                error:function(jqXHR){
                    console.log("Error: "+jqXHR.status);
                }
            });
            return false;
        });
        form.on('select(cont)',function(data){
            if(data.value!='-1'){
                $("#message").show();
                $.ajax({
                    type:"GET",
                    url:"/contMessage.do",
                    data:{
                        cid:data.value
                    },
                    dataType:"text",
                    success:function(is){
                        $("#contMessage").text(is);
                    },
                    error:function(jqXHR){
                        console.log("Error: "+jqXHR.status);
                    }
                });
            }
        });
        /*
        * 加载页面发送ajax请求获取所有客户信息
        * */
        $.ajax({
            type:"GET",
            url:"/queryClient.do",
            data:{},
            dataType:"json",
            success:function(is){
                var dep=document.getElementById("client");
                for(var i=0;i<is.length;i++){
                    var op=new Option(is[i].customername,is[i].cid);
                    dep.add(op);
                }
                form.render("select");
            },
            error:function(jqXHR){
                console.log("Error: "+jqXHR.status);
            }
        });

        $.ajax({
            type:"GET",
            url:"/modelServiceList.do",
            data:{},
            dataType:"json",
            success:function(is){
                var dep=document.getElementById("typeservice");
                for(var i=0;i<is.length;i++){
                    var op=new Option(is[i].title,is[i].id);
                    dep.add(op);
                }
                form.render("select");
            },
            error:function(jqXHR){
                console.log("Error: "+jqXHR.status);
            }
        });
        $.ajax({
            type:"GET",
            url:"/typeServiceList.do",
            data:{},
            dataType:"json",
            success:function(is){
                var dep=document.getElementById("modelservice");
                for(var i=0;i<is.length;i++){
                    var op=new Option(is[i].title,is[i].id);
                    dep.add(op);
                }
                form.render("select");
            },
            error:function(jqXHR){
                console.log("Error: "+jqXHR.status);
            }
        });
        var uploadInst = upload.render({
            elem: '#test1' //绑定元素
            ,accept:"file"
            ,url: '/singleUpload.do' //上传接口
            ,done: function(res){
                //上传完毕回调
                layer.alert('上传成功', {icon: 1});
                table.reload('test', {});
            }
            ,error: function(){
                //请求异常回调
            }
        });
    });
</script>
</div>
</body>
</html>